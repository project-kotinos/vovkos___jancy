

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>class jnc.Scheduler &mdash; Jancy Standard Library Reference</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'1.8.5',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/target-highlight.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/doxyrest-pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/doxyrest-sphinx_rtd_theme.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Standard Typedefs" href="group_g1_typedef.html" />
    <link rel="prev" title="class jnc.RegexState" href="class_jnc_RegexState.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Jancy Standard Library Reference
          

          
          </a>

          
            
            
              <div class="version">
                1.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="group_g2_crt.html">C Runtime Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_stdlib.html">General Purpose Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_iolib.html">IO (Input/Output) Library</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="group_rtl.html">RTL (Runtime Library)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="struct_jnc_RegexMatch.html">struct jnc.RegexMatch</a></li>
<li class="toctree-l2"><a class="reference internal" href="class_jnc_DynamicLib.html">class jnc.DynamicLib</a></li>
<li class="toctree-l2"><a class="reference internal" href="class_jnc_RegexState.html">class jnc.RegexState</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">class jnc.Scheduler</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#detailed-documentation">Detailed Documentation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#methods">Methods</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="group_g1_typedef.html">Standard Typedefs</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_syslib.html">System Facilities</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="syncId.html">syncId Model Explanation</a></li>
<li class="toctree-l1"><a class="reference internal" href="disposable.html">Using Disposable Pattern</a></li>
<li class="toctree-l1"><a class="reference internal" href="errorcode.html">errorcode Functions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="global.html">Global Namespace</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Jancy Standard Library Reference</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="group_rtl.html">RTL (Runtime Library)</a> &raquo;</li>
        
      <li>class jnc.Scheduler</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="class-jnc-scheduler">
<span id="doxid-type-jnc-scheduler"></span><span id="index-0"></span><h1>class jnc.Scheduler</h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="overview">
<h2>Overview</h2>
<p>This interface is used by Jancy compiler when creating <em>scheduled</em>
function pointers. <a class="reference internal" href="#details-type-jnc-scheduler"><span class="std std-ref">Moreâ€¦</span></a></p>
<pre class="highlight doxyrest-overview-code-block literal-block">
<span></span><span class="k">class</span> <span class="n">Scheduler</span>
<span class="p">{</span>
    <span class="c1">// methods</span>

    <span class="k">abstract</span> <span class="k">void</span> <a class="reference internal" href="#doxid-function-jnc-scheduler-schedule"><span class="std std-ref">schedule</span></a><span></span><span class="p">(</span><span class="k">void</span> <span class="k">function</span><span class="o">*</span> <span class="n">proc</span> <span class="p">());</span>
    <span class="k">void</span> <span class="n">async</span> <span class="doxyrest-code-target target" id="doxid-function-jnc-scheduler-asyncschedule">asyncSchedule</span><span></span><span class="p">(</span><span class="k">bool</span> <span class="n">isOnce</span> <span class="o">=</span> <span class="k">false</span><span class="p">);</span>
<span class="p">};</span>
</pre>
</div>
<div class="section" id="detailed-documentation">
<span id="details-type-jnc-scheduler"></span><h2>Detailed Documentation</h2>
<p>This interface is used by Jancy compiler when creating <em>scheduled</em>
function pointers.</p>
<p>Often times it is necessary to postpone execution of a certain callback
function(e.g. IO completion routine or other event handler). A realistic
example would be this: IO completion event gets fired in some worker IO
thread context, but we want to conveniently process it in the context of
the main UI thread. Should you write this code in C, Java or any other
traditional language, you would probably use a variation of the following
approach:</p>
<ol class="arabic simple">
<li>allocate some struct;</li>
<li>use it to store IO completion event parameters(e.g. completion status,
received data size, remote node address etc);</li>
<li>add this struct to some <em>request</em> list;</li>
<li>send some kind of UI message to wake up the main thread;</li>
<li>process the list of pending requests in the main thread.</li>
</ol>
<p>Since this is such a typical problem in asynchronous IO programming and
Jancy was conceived as <em>the</em> scripting language for IO programming, it is
of no surprise that Jancy features a special facility to solve problems
just like this in a much more elegant way.</p>
<p>Jancy has a concept of a <em>scheduled</em> function pointer, i.e. the pointer to
a function which <em>requires</em> some specific execution environment. When you
call a <em>scheduled</em> function pointer, the function it points to does not get
invoked immediatly. Instead, it will be postponed until the execution
environment is exactly what the function expects it to be.</p>
<p>Of course, Jancy compiler has <em>no idea</em> which environment is required for
this particular function. But the programmer surely knows. So, the
programmer can write a <em>scheduler</em> which will execute <em>abstract</em> function
pointer in the proper execution environment. Then you take this scheduler
and use it to create scheduled function pointers of <em>any</em> type.</p>
<p class="rubric">Sample code:</p>
<pre class="highlight literal-block">
<span></span><span class="k">import</span> <span class="s">&quot;sys_Lock.jnc&quot;</span>

<span class="k">class</span> <span class="n">LockScheduler</span>
<span class="p">{</span>
    <span class="n">sys</span><span class="p">.</span><span class="n">Lock</span><span class="o">*</span> <span class="n">m_lock</span><span class="p">;</span>

    <span class="k">override</span> <span class="n">schedule</span><span class="p">(</span><span class="k">void</span> <span class="k">function</span><span class="o">*</span> <span class="n">f</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="n">m_lock</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
        <span class="n">f</span><span class="p">();</span>
        <span class="n">m_lock</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">sys</span><span class="p">.</span><span class="n">Lock</span> <span class="n">g_lock</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">OnComplete</span><span class="p">(</span><span class="k">int</span> <span class="n">x</span><span class="p">);</span>

<span class="n">work</span><span class="p">(</span><span class="n">OnComplete</span><span class="o">*</span> <span class="n">onComplete</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="n">onComplete</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">bar</span><span class="p">(</span><span class="k">int</span> <span class="n">a</span><span class="p">,</span> <span class="k">int</span> <span class="n">b</span><span class="p">,</span> <span class="k">int</span> <span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">$&quot;bar ($a, $b, $c) -- MUST be called under g_lock&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">foo</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">LockScheduler</span> <span class="n">scheduler</span><span class="p">;</span>
    <span class="n">scheduler</span><span class="p">.</span><span class="n">m_lock</span> <span class="o">=</span> <span class="n">g_lock</span><span class="p">;</span> <span class="c1">// initialize scheduler</span>

    <span class="p">(</span><span class="n">bar</span> <span class="o">@</span> <span class="n">scheduler</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// schedule immediatly</span>
    <span class="n">work</span><span class="p">(</span><span class="n">bar</span> <span class="o">~</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span> <span class="o">@</span> <span class="n">scheduler</span><span class="p">);</span> <span class="c1">// pass as completion routine</span>
<span class="p">}</span>
</pre>
<div class="section" id="methods">
<h3>Methods</h3>
<pre class="highlight doxyrest-title-code-block literal-block" id="doxid-function-jnc-scheduler-schedule">
<span id="index-1"></span><span></span><span class="k">abstract</span> <span class="k">void</span> <span class="n">schedule</span><span class="p">(</span><span class="k">void</span> <span class="k">function</span><span class="o">*</span> <span class="n">proc</span> <span class="p">())</span>
</pre>
<p>Implement this abstract function to perform the required scheduling.
Note that even though the argument has type of simple function pointer
<code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">function*</span> <span class="pre">()</span></code>, the resulting scheduler will be capable of
handling function pointers of <em>any</em> type</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="group_g1_typedef.html" class="btn btn-neutral float-right" title="Standard Typedefs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="class_jnc_RegexState.html" class="btn btn-neutral float-left" title="class jnc.RegexState" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2012-2019, Tibbo Technology Inc

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>