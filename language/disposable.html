

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Deterministic Resource Release &mdash; Jancy Language Manual</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'1.8.5',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/target-highlight.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/doxyrest-pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/doxyrest-sphinx_rtd_theme.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Compatibility with C" href="c_compatibility.html" />
    <link rel="prev" title="Exception Handling" href="exceptions.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Jancy Language Manual
          

          
          </a>

          
            
            
              <div class="version">
                1.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="language.html">Jancy Language</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="hello_world.html">Hello World</a></li>
<li class="toctree-l2"><a class="reference internal" href="type_primitive.html">Primitive Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="decl_simple.html">Simple Declarations</a></li>
<li class="toctree-l2"><a class="reference internal" href="decl_advanced.html">Advanced Declarations</a></li>
<li class="toctree-l2"><a class="reference internal" href="decl_curly.html">Curly Initializers</a></li>
<li class="toctree-l2"><a class="reference internal" href="decl_storage.html">Storage Specifiers</a></li>
<li class="toctree-l2"><a class="reference internal" href="literals.html">Literals</a></li>
<li class="toctree-l2"><a class="reference internal" href="aliases.html">Aliases</a></li>
<li class="toctree-l2"><a class="reference internal" href="function_redirection.html">Function Redirection</a></li>
<li class="toctree-l2"><a class="reference internal" href="cflow.html">Control Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="prop.html">Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="nspace.html">Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="type_named.html">Named Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="type_ptr.html">Pointer Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="multicasts.html">Multicasts and Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="reactive.html">Reactive Programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="regex_switches.html">Regex Switches</a></li>
<li class="toctree-l2"><a class="reference internal" href="schedulers.html">Schedulers</a></li>
<li class="toctree-l2"><a class="reference internal" href="dynamic_structs.html">Dynamic Structs</a></li>
<li class="toctree-l2"><a class="reference internal" href="dual_modifiers.html">Dual Modifiers</a></li>
<li class="toctree-l2"><a class="reference internal" href="exceptions.html">Exception Handling</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Deterministic Resource Release</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="c_compatibility.html">Compatibility with C</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Jancy Language Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="language.html">Jancy Language</a> &raquo;</li>
        
      <li>Deterministic Resource Release</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="deterministic-resource-release">
<h1>Deterministic Resource Release</h1>
<p>Jancy provides a convenient facility for ensuring the deterministic resource release in an inherently non-deterministic GC-world. This is achieved with <code class="docutils literal notranslate"><span class="pre">disposable</span></code> storage specifier.</p>
<p>Classes in Jancy can have destructors. Therefore, all the necessary resource release operations (e.g. closing files, dropping connections, releasing locks etc) could be placed in destructors. The problem is, destructors in garbage-collected world are not called deterministically. First the Garbage Collector must decide it needs to free unreachable objects; then the mark stage must complete. Only then the destructor of an about-to-be-freed object will be called. Keeping resources acquired for that long is simply not acceptable.</p>
<p>To remedy this problem, Jancy features duck-typed pattern <strong>Disposable</strong>. All the variables (of <code class="docutils literal notranslate"><span class="pre">class</span></code>, <code class="docutils literal notranslate"><span class="pre">struct</span></code> or <code class="docutils literal notranslate"><span class="pre">union</span></code> types) declared using <code class="docutils literal notranslate"><span class="pre">disposable</span></code> storage will have their <code class="docutils literal notranslate"><span class="pre">dispose</span></code> method called upon exiting the scope.</p>
<p>This method will be called no matter which exit route is taken, be it normal control flow, <code class="docutils literal notranslate"><span class="pre">return</span></code>, <code class="docutils literal notranslate"><span class="pre">break</span></code>, <code class="docutils literal notranslate"><span class="pre">throw</span></code>, other exception(s) etc.</p>
<p class="rubric">Example:</p>
<pre class="highlight literal-block">
<span></span><span class="n">foo</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">disposable</span> <span class="n">io</span><span class="p">.</span><span class="n">File</span> <span class="n">file</span><span class="p">;</span>
    <span class="n">file</span><span class="p">.</span><span class="n">open</span> <span class="p">();</span>

    <span class="c1">// work with file...</span>
<span class="p">}</span> <span class="c1">// &lt;-- file.close () is guaranteed to be called upon exiting the scope</span>
</pre>
<p>When program runs out of scope where a variable of disposable class was declared in, Jancy compiler will insert a call to <code class="docutils literal notranslate"><span class="pre">dispose</span></code> method (which is usually <em>aliased</em> to an actual release methods such as <code class="docutils literal notranslate"><span class="pre">close</span></code>). This method will be called no matter how the program runs out of scope, be it a normal control flow, <code class="docutils literal notranslate"><span class="pre">return</span></code>,  <code class="docutils literal notranslate"><span class="pre">break</span></code>, <code class="docutils literal notranslate"><span class="pre">continue</span></code> or an exception.</p>
<p>You can easily write disposable classes yourself. All you have to do is to provide a <code class="docutils literal notranslate"><span class="pre">dispose</span></code> method (or a <code class="docutils literal notranslate"><span class="pre">dispose</span></code> alias):</p>
<pre class="highlight literal-block">
<span></span><span class="k">class</span> <span class="n">MyDisposableClass</span>
<span class="p">{</span>
    <span class="c1">//...</span>
    <span class="n">dispose</span> <span class="p">()</span>
    <span class="p">{</span>
        <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;Releasing resources...&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="n">MyDbConnection</span>
<span class="p">{</span>
    <span class="c1">//...</span>
    <span class="n">disconnect</span> <span class="p">();</span>
    <span class="k">alias</span> <span class="n">dispose</span> <span class="o">=</span> <span class="n">disconnect</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">foo</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">disposable</span> <span class="n">MyDisposableClass</span> <span class="n">c</span><span class="p">;</span>
    <span class="k">disposable</span> <span class="n">MyDbConnection</span> <span class="n">db</span><span class="p">;</span>

    <span class="c1">// work with c &amp; db...</span>

    <span class="k">throw</span><span class="p">;</span> <span class="c1">// &lt;-- c.dispose () and db.disconnect () will get called</span>
<span class="p">}</span>
</pre>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="c_compatibility.html" class="btn btn-neutral float-right" title="Compatibility with C" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="exceptions.html" class="btn btn-neutral float-left" title="Exception Handling" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2012-2019, Tibbo Technology Inc

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>