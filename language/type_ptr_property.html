

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Property Pointers &mdash; Jancy Language Manual</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'1.8.5',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/target-highlight.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/doxyrest-pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/doxyrest-sphinx_rtd_theme.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Multicasts and Events" href="multicasts.html" />
    <link rel="prev" title="Function Pointers" href="type_ptr_function.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Jancy Language Manual
          

          
          </a>

          
            
            
              <div class="version">
                1.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="language.html">Jancy Language</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="hello_world.html">Hello World</a></li>
<li class="toctree-l2"><a class="reference internal" href="type_primitive.html">Primitive Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="decl_simple.html">Simple Declarations</a></li>
<li class="toctree-l2"><a class="reference internal" href="decl_advanced.html">Advanced Declarations</a></li>
<li class="toctree-l2"><a class="reference internal" href="decl_curly.html">Curly Initializers</a></li>
<li class="toctree-l2"><a class="reference internal" href="decl_storage.html">Storage Specifiers</a></li>
<li class="toctree-l2"><a class="reference internal" href="literals.html">Literals</a></li>
<li class="toctree-l2"><a class="reference internal" href="aliases.html">Aliases</a></li>
<li class="toctree-l2"><a class="reference internal" href="function_redirection.html">Function Redirection</a></li>
<li class="toctree-l2"><a class="reference internal" href="cflow.html">Control Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="prop.html">Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="nspace.html">Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="type_named.html">Named Types</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="type_ptr.html">Pointer Types</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="type_ptr_data.html">Data Pointers</a></li>
<li class="toctree-l3"><a class="reference internal" href="type_ptr_class.html">Class Pointers</a></li>
<li class="toctree-l3"><a class="reference internal" href="type_ptr_const.html">Const-correctness</a></li>
<li class="toctree-l3"><a class="reference internal" href="type_ptr_function.html">Function Pointers</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Property Pointers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="multicasts.html">Multicasts and Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="reactive.html">Reactive Programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="regex_switches.html">Regex Switches</a></li>
<li class="toctree-l2"><a class="reference internal" href="schedulers.html">Schedulers</a></li>
<li class="toctree-l2"><a class="reference internal" href="dynamic_structs.html">Dynamic Structs</a></li>
<li class="toctree-l2"><a class="reference internal" href="dual_modifiers.html">Dual Modifiers</a></li>
<li class="toctree-l2"><a class="reference internal" href="exceptions.html">Exception Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="disposable.html">Deterministic Resource Release</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="c_compatibility.html">Compatibility with C</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Jancy Language Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="language.html">Jancy Language</a> &raquo;</li>
        
          <li><a href="type_ptr.html">Pointer Types</a> &raquo;</li>
        
      <li>Property Pointers</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="property-pointers">
<h1>Property Pointers</h1>
<p>Property pointers are yet another unique feature of Jancy.</p>
<p>Properties are found in many modern languages. What commonly lacks is a developed syntax and semantics of pointer declarations and operators.</p>
<p>Property pointers resemble and are closely related to function pointers. Dealing with property pointers requires a more careful application of address <strong>&amp;</strong> and indirection <strong>*</strong> operators. This is due to the possibility of implicit invocation of property accessors and the ambiguity induced by such invocation, which can be automatically resolved with function pointers and not with property pointers.</p>
<p>Like the function pointers, property pointers can be normal (fat) or <code class="docutils literal notranslate"><span class="pre">thin</span></code>. <code class="docutils literal notranslate"><span class="pre">thin</span></code> property pointers hold a single pointer to the property accessor table.</p>
<div class="highlight-jnc notranslate"><div class="highlight"><pre><span></span><span class="k">int</span> <span class="k">autoget</span> <span class="k">property</span> <span class="n">g_prop</span><span class="p">;</span>

<span class="n">g_prop</span><span class="p">.</span><span class="k">set</span> <span class="p">(</span><span class="k">int</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="n">foo</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="k">int</span> <span class="k">property</span> <span class="k">thin</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">g_prop</span><span class="p">;</span>
    <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Like with the function pointers, the argument conversion is automated (compiler generates thunks if needed).</p>
<div class="highlight-jnc notranslate"><div class="highlight"><pre><span></span><span class="k">int</span> <span class="k">autoget</span> <span class="k">property</span> <span class="n">g_prop</span><span class="p">;</span>

<span class="n">g_prop</span><span class="p">.</span><span class="k">set</span> <span class="p">(</span><span class="k">int</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="n">foo</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="k">typedef</span> <span class="k">double</span> <span class="k">property</span> <span class="n">FpProp</span><span class="p">;</span>

    <span class="c1">// explicit cast is required to generate a thunk</span>
    <span class="n">FpProp</span> <span class="k">thin</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">FpProp</span> <span class="k">thin</span><span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">g_prop</span><span class="p">;</span>

    <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="mf">2.71</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Fat property pointers support partial application by capturing arguments in the closure.</p>
<div class="highlight-jnc notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="n">C1</span>
<span class="p">{</span>
    <span class="k">int</span> <span class="k">autoget</span> <span class="k">property</span> <span class="n">m_prop</span><span class="p">;</span>

    <span class="n">m_prop</span><span class="p">.</span><span class="k">set</span> <span class="p">(</span><span class="k">int</span> <span class="n">x</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">foo</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="n">C1</span> <span class="n">c</span><span class="p">;</span>
    <span class="k">int</span> <span class="k">property</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">m_prop</span><span class="p">;</span>
    <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It is also possible to capture index arguments in the closure, thus reducing dimensions of indexed properties or completely de-indexing them. Skipping indexes is OK, too.</p>
<div class="highlight-jnc notranslate"><div class="highlight"><pre><span></span><span class="k">property</span> <span class="n">g_prop</span>
<span class="p">{</span>
    <span class="k">int</span> <span class="k">get</span> <span class="p">(</span>
        <span class="k">unsigned</span> <span class="n">i</span><span class="p">,</span>
        <span class="k">unsigned</span> <span class="n">j</span>
        <span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="k">set</span> <span class="p">(</span>
        <span class="k">unsigned</span> <span class="n">i</span><span class="p">,</span>
        <span class="k">unsigned</span> <span class="n">j</span><span class="p">,</span>
        <span class="k">int</span> <span class="n">x</span>
        <span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">foo</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="k">int</span> <span class="k">indexed</span> <span class="k">property</span><span class="o">*</span> <span class="n">p</span> <span class="p">(</span><span class="k">unsigned</span><span class="p">)</span> <span class="o">=</span> <span class="n">g_prop</span> <span class="p">[]</span> <span class="p">[</span><span class="mi">20</span><span class="p">];</span>
    <span class="o">*</span><span class="n">p</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span> <span class="c1">// =&gt; g_prop [10] [20] = 100;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Like function pointers, property pointers can be <code class="docutils literal notranslate"><span class="pre">weak</span></code>, meaning that they do not retain selected objects in the closure from being collected by the garbage collector.</p>
<div class="highlight-jnc notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="n">C1</span>
<span class="p">{</span>
    <span class="k">int</span> <span class="k">autoget</span> <span class="k">property</span> <span class="n">m_prop</span><span class="p">;</span>

    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="n">C1</span><span class="p">.</span><span class="n">m_foo</span><span class="p">.</span><span class="k">set</span> <span class="p">(</span><span class="k">int</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="n">foo</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="n">C1</span><span class="o">*</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="n">C1</span><span class="p">;</span>

    <span class="k">int</span> <span class="k">property</span> <span class="k">weak</span><span class="o">*</span> <span class="n">w</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">.</span><span class="n">m_prop</span><span class="p">;</span>

    <span class="c1">// uncomment the next line and C1 will get collected next gc run</span>
    <span class="c1">// c = null;</span>

    <span class="n">std</span><span class="p">.</span><span class="n">collectGarbage</span> <span class="p">();</span>

    <span class="k">int</span> <span class="k">property</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="n">w</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// object survived GC run, access it</span>
        <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="multicasts.html" class="btn btn-neutral float-right" title="Multicasts and Events" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="type_ptr_function.html" class="btn btn-neutral float-left" title="Function Pointers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2012-2019, Tibbo Technology Inc

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>